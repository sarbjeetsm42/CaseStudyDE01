/* HIVE 4- QUERY TO CREATE META DATA FOR BRANCH TABLE AND LOAD DATA */

USE CREDIT_CARD_DB;

DROP TABLE temp_b;

CREATE TEMPORARY EXTERNAL TABLE temp_b (

  BRANCH_CODE BIGINT,
  BRANCH_NAME STRING,
  BRANCH_STREET STRING,
  BRANCH_CITY STRING,
  BRANCH_STATE STRING,
  BRANCH_ZIP INT,
  BRANCH_PHONE STRING,
  LAST_MODIFIED TIMESTAMP
  )

ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','

LOCATION '/user/maria_dev/Credit_Card_System/branch';


DROP TABLE CDW_SAPP_D_BRANCH;

CREATE EXTERNAL TABLE CDW_SAPP_D_BRANCH (

  BRANCH_CODE BIGINT,
  BRANCH_NAME STRING,
  BRANCH_STREET STRING,
  BRANCH_CITY STRING,
  BRANCH_ZIP INT,
  BRANCH_PHONE STRING,
  LAST_MODIFIED TIMESTAMP
  )

PARTITIONED BY (BRANCH_STATE STRING)

ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','

LOCATION '/user/maria_dev/Credit_Card_System/branch1';


set hive.exec.dynamic.partition.mode=nonstrict;

INSERT INTO TABLE CDW_SAPP_D_BRANCH

PARTITION(BRANCH_STATE)

SELECT
  BRANCH_CODE,
  BRANCH_NAME,
  BRANCH_STREET,
  BRANCH_CITY,
  BRANCH_ZIP,
  BRANCH_PHONE,
  LAST_MODIFIED,
  BRANCH_STATE
FROM temp_b;
